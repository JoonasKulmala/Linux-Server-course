# h6 | Joonas Kulmala

- [h6 | Joonas Kulmala](#h6--joonas-kulmala)
  - [Exercise goals and enviroment](#exercise-goals-and-enviroment)
  - [Exercises](#exercises)
    - [a) Simple database wep application](#a-simple-database-wep-application)
    - [b) Implement WSGI](#b-implement-wsgi)
  - [Final thoughts](#final-thoughts)
  - [Sources](#sources)
      - [Tero Karvinen, Linux Server Course - Linux palvelimet ict4tn021-3014 - alkukevät 2021](#tero-karvinen-linux-server-course---linux-palvelimet-ict4tn021-3014---alkukevät-2021)
      - [Tero Karvinen, Flask Automatic Forms](#tero-karvinen-flask-automatic-forms)
      - [Toni Vapalo, Create Read Update Delete tominnallisuus Flask ohjelma - Viikkotehtävä 6](#toni-vapalo-create-read-update-delete-tominnallisuus-flask-ohjelma---viikkotehtävä-6)
  - [Edit history](#edit-history)

## Exercise goals and enviroment

This exercise outcome requires Python 3, Flask and several modules such as SQLAlchemy and Flask-WTF.

[This](https://terokarvinen.com/2020/flask-automatic-forms/) guide by Tero was used as a template for the exercise.

As always the exercises & material can be found on **Tero Karvinen**'s [website](https://terokarvinen.com/2020/linux-palvelimet-2021-alkukevat-kurssi-ict4tn021-3014/#h6.)

## Exercises

### a) Simple database wep application

We'll need a few things to make this work: a Python program to run the thing, a database where to store information and HTML forms to process the data.

Let's start with the Python program. I'll name it ```DatabaseApp.py``` and use Tero's code as a template


```bash
#!/usr/bin/python3
"RSVP autoform"
# Copyright 2020 Tero Karvinen http://TeroKarvinen.com

from flask import Flask, render_template, flash, redirect
from flask_sqlalchemy import SQLAlchemy
from wtforms.ext.sqlalchemy.orm import model_form
from flask_wtf import FlaskForm
import wtforms

app = Flask(__name__)
db = SQLAlchemy(app)
app.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///autoformed.db"
app.config["SQLALCHEMY_TRACK_MODIFICATIONS"] = False
app.config["SECRET_KEY"] = "dUCF)mtd9MAoZ?;R|8*iB^.+TCV//0"

class Reply(db.Model):
        id = db.Column(db.Integer, primary_key=True)
        coming = db.Column(db.Boolean, nullable=False)
        email = db.Column(db.String, nullable=False)
        name = db.Column(db.String, nullable=False)

field_args = { "email": {"validators": [wtforms.validators.Email()]} }
ReplyForm = model_form(model=Reply, base_class=FlaskForm, db_session=db.session, field_args=field_args)

@app.before_first_request
def beforeFirstRequest():
        db.create_all()

@app.route("/", methods=["GET", "POST"])
def index():
        form = ReplyForm()

        if form.validate_on_submit():
                reply = Reply()
                form.populate_obj(reply)
                db.session.add(reply)
                db.session.commit()
                flash("Your reply has been added. Welcome!")
                return redirect("/")
        replies = db.session.query(Reply)
        return render_template("replies.html", form=form, replies=replies)

def main():
        app.run(debug=True)

if __name__ == "__main__":
        main()
```

Database will be autogenerated upon first launch of the application:

```bash
@app.before_first_request
def beforeFirstRequest():
        db.create_all()
```

The HTML pages ca be found [here](templates/base.html) and [here](templates/replies.html).

Let's run the application:
```bash
$ python3 DatabaseApp.py
...
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

[Form](Resources/Form.png)

### b) Implement WSGI

I still have issues with WSGI, and so must keep working on it for now. I keep running into different errors depending on how I'm messing with the settings.

Permission denied:
```bash
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>403 Forbidden</title>
</head><body>
<h1>Forbidden</h1>
<p>You don't have permission to access this resource.</p>
<hr>
<address>Apache/2.4.41 (Ubuntu) Server at databaseappwsgi.example.com Port 80</address>
</body></html>
```

Broken path:
```bash
AH00526: Syntax error on line 3 of /etc/apache2/sites-enabled/DatabaseApp.conf:
Invalid option to WSGI script alias definition.
Action 'configtest' failed.
The Apache error log may have more information.
```

I'll have to look into WSGI from the beginning in order to fix these issues.

## Final thoughts

Running into issues with WSGI keeps hindering my progress.

## Sources

#### Tero Karvinen, [Linux Server Course - Linux palvelimet ict4tn021-3014 - alkukevät 2021](https://terokarvinen.com/2020/linux-palvelimet-2021-alkukevat-kurssi-ict4tn021-3014/#h6)
#### Tero Karvinen, [Flask Automatic Forms](https://terokarvinen.com/2020/flask-automatic-forms/)
#### Toni Vapalo, [Create Read Update Delete tominnallisuus Flask ohjelma - Viikkotehtävä 6](https://tonivapalo.com/viikkotehtava-6)

## Edit history

